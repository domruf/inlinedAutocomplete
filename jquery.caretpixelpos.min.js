window.maxkir||(maxkir={}),maxkir.SelectionRange=function(e){this.element=e},maxkir.SelectionRange.prototype.get_selection_range=function(){var e=function(e){if(typeof e.selectionStart=="undefined"&&document.selection){var t=document.selection.createRange(),n=t.duplicate();e.type=="text"?(n.moveStart("character",-e.value.length),n.moveEnd("character",e.value.length)):n.moveToElementText(e),n.setEndPoint("EndToEnd",t);var r=n.text.length-t.text.length,i=r+t.text.length;return[r,i]}return[e.selectionStart,e.selectionEnd]};try{return e(this.element)}catch(t){return[0,0]}},maxkir.SelectionRange.prototype.get_selection_text=function(){var e=this.get_selection_range();return this.element.value.substring(e[0],e[1])},window.maxkir||(maxkir={}),maxkir.StringSplitter=function(e){this.get_width=e},maxkir.StringSplitter.prototype.splitString=function(e,t){if(e.length==0)return[""];var n=-1,r=!1,i=this,s=function(n){var r=e.substr(n+1);return r.length>0?[e.substr(0,n+1)].concat(i.splitString(r,t)):[e.substr(0,n+1)]};for(var o=0;o<e.length;o++){if(e.charAt(o)==" "){r=this.get_width(e.substr(0,o))>t;if(r&&n>0)return s(n);if(r)return s(o);n=o}if(e.charAt(o)=="\n")return s(o)}return n>0&&this.get_width(e)>t?s(n):[e]},window.maxkir||(maxkir={}),maxkir.FF=/Firefox/i.test(navigator.userAgent),typeof document.defaultView=="undefined"&&(document.defaultView={},document.defaultView.getComputedStyle=function(e){return e.currentStyle}),maxkir.CursorPosition=function(e,t){this.element=e,this.padding=t,this.selection_range=new maxkir.SelectionRange(e);var n=this;this.get_string_metrics=function(n){return maxkir.CursorPosition.getTextMetrics(e,n,t)};var r=new maxkir.StringSplitter(function(e){var t=n.get_string_metrics(e);return t[0]});this.split_to_lines=function(){var t=e.scrollWidth;maxkir.FF&&(t-=4);var i=n.selection_range.get_selection_range()[0];return r.splitString(e.value.substr(0,i),t)}},maxkir.CursorPosition.prototype.getCursorCoordinates=function(){var e=this.split_to_lines();return[e[e.length-1].length,e.length]},maxkir.CursorPosition.prototype.getPixelCoordinates=function(){var e=this.split_to_lines(),t=this.get_string_metrics(e[e.length-1]),n=t[0],r=t[1]*e.length-this.element.scrollTop+this.padding;return[n,r]},maxkir.CursorPosition.getTextMetrics=function(e,t,n){var r=e,i=function(e,t){var n=r.style[t];if(!n){var i=document.defaultView.getComputedStyle(r,null);n=i?i[t]:null}n&&(e.style[t]=n)},s="__widther",o=document.getElementById(s);return o||(o=document.createElement("div"),document.body.appendChild(o),o.id=s,o.style.position="absolute",o.style.left="-10000px"),i(o,"fontSize"),i(o,"fontFamily"),i(o,"fontWeight"),i(o,"fontVariant"),i(o,"fontStyle"),i(o,"textTransform"),i(o,"lineHeight"),o.style.width="0",o.style.paddingLeft=n+"px",o.innerHTML=t.replace(" ","&nbsp;"),o.style.width="auto",[o.offsetWidth,o.offsetHeight]},function(e){e.fn.caretpixelpos=function(){typeof this.positioner=="undefined"&&(this.positioner=new maxkir.CursorPosition(this[0],7));var e=this.positioner.getPixelCoordinates(),t=this.offset();return{left:t.left+e[0],top:t.top+e[1],childPos:{left:e[0],top:e[1]}}}}.call(this,jQuery);